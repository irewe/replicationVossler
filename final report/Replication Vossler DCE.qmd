---
title: "Replication Vossler DCE"
format: html
editor: visual
---

# Introduction

Vossler et al. .....

# Replication process

## Data preparation

We first read the data that they used in their model.

```{r}
library(data.table)
data <- fread("../data/dataVossler.tab")
colnames(data)
head(data[RespondentID %in% c(1), c("RespondentID", "ChoiceID", "Referendum", "Vote", "ASC")], 40)[order(ChoiceID)]
```

We have a lot of variables in the data and for each respondent there is one row for each possible Referendum and for the corresponding "current state scenario". If the respondent did get a Referendum as an option the column "Vote" will not be NA. So first we remove rows where Vote is NA. Then we make the data wide so that for each ChoiceID (which is unique per choice set and respondent) we have columns for the current state scenario (ASC = 0) and columns for the proposed referendum in that choice set (ASC = 1). We only keep the variables that we use in the models that we replicated.

```{r}

data <- data[!is.na(Vote)]
data <- data[order(ChoiceID, ASC)]

data <- data[order(ChoiceID, ASC)]

## Make wide format
data_wide <- dcast(
  data,
  ChoiceID + RespondentID + Referendum +
  HUC8BCG + HUC4BCG_base + HUC4BCG_scenario1 +
  HUC4BCG_scenario2 + MediumBCG_base + MediumBCG_scenario1 +
  MediumBCG_scenario2 + HUC4BCG_base_NL + HUC4BCG_scenario2_NL +
  MediumBCG_base_NL + MediumBCG_scenario2_NL ~ ASC,   # Reshape by Alternative
  value.var = c(
    "Vote", "Cost",
    "WQ_HUC8", "WQ_HUC4", "WQ_Medium", "WQ_Large", 
    "WQ_HUC4_NL", "WQ_Medium_NL",
    "ASC_PercentInstate", "ASC_PercentInstate_NL")  # Columns to spread
)

## Make only one choice column (1 if they voted for referendum, 0 if they voted for current status)
data_wide$choice <- data_wide$Vote_1
data_wide$Vote_0 <- NULL
data_wide$Vote_1 <- NULL

data_wide$ASC_0 <- 0
data_wide$ASC_1 <- 1
```

## Models

### Model 1 - Mixed logit..
```{r}
library(apollo)
database <- data_wide
```
